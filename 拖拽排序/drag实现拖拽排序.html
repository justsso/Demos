<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <style>
        .wrap {
        }

        .item {
            width: 400px;
            border: 1px solid #e6dede;
            background: #fff;
        }
    </style>
</head>
<body>

<div class="wrap">
</div>
<script>
    let arr = [
        {text: '111', name: 'Jack', description: 'hello world'},
        {text: '222', name: 'Rose', description: 'beautify'},
        {text: '333', name: '黛玉', description: '天上掉下个林妹妹'},
        {text: '444', name: '宝钗', description: '宝钗贳酒'},
        {text: '555', name: '张筱雨', description: '三百亿'}];
    let $ = (str) => document.querySelector(str);
    let $$ = (str) => document.querySelectorAll(str);
    let wrap = $('.wrap');
    let dragObj = null, enterObj = null, dragIndex, enterIndex;

    render(arr)


    wrap.addEventListener('dragstart', function (e) {
        console.log('dragstart')
        dragObj = e.target
        dragIndex = e.target.dataset.index;
        e.target.style.opacity = '0'
    })

    wrap.addEventListener('dragend', function (e) {
        console.log('dragend')
        e.target.style.opacity = "1";
        e.preventDefault();  // 避免浏览器的默认行为，drop事件的默认行为打开链接
        //在当前元素之前插;

        if (enterIndex !== dragIndex) {
            if (enterIndex > dragIndex) {
                let delteChild = arr.splice(dragIndex, 1)[0]
                arr.splice(enterIndex, 0, delteChild)
                // 删掉所有节点
                wrap.innerHTML = '';
                render(arr)
            } else {
                let deleChild = arr.splice(dragIndex, 1)[0];
                arr.splice(enterIndex, 0, deleChild);
                console.log(arr, 59)
                wrap.innerHTML = '';
                render(arr)
            }
        }
    })

    wrap.addEventListener('dragenter', function (e) {
        console.log('dragenter 触发动画');
        let items = $$('.item');

        if (e.target.className === 'item') {
            enterObj = e.target;
            enterIndex = e.target.dataset.index;

            if (enterObj !== dragObj) {
                if (enterIndex < dragIndex) {
                    items.forEach(item => {
                        if (item.dataset.index < enterIndex) {
                            item.style.transform = 'translate(0,0)';
                        } else if (item.dataset.index >= enterIndex && item.dataset.index < dragIndex) {
                            item.style.transform = `translate(0, 100%)`;
                        } else {
                            item.style.transform = 'translate(0,0)';
                        }
                    })
                } else {
                    items.forEach(item => {
                        if (item.dataset.index < dragIndex) {
                            item.style.transform = 'translate(0,0)';
                        } else if (item.dataset.index > dragIndex && item.dataset.index <= enterIndex) {
                            item.style.transform = `translate(0, -100%)`;
                        } else {
                            item.style.transform = 'translate(0,0)';
                        }
                    })
                }
            } else {
                // 是本元素，所有元素归位
                items.forEach(item => {
                    item.style.transform = 'translate(0,0)';
                })
            }
        }
    })

    function render(arr) {
        arr.forEach((text, i) => {
            let item = document.createElement('div')
            item.classList = 'item';
            item.innerHTML = `<p>
${text.text} <strong>${text.name}</strong>
</p>
<p>
${text.description}
</p>`;
            item.draggable = true;
            item.dataset.index = i;
            item.style.transition = 'all 0.2s ease';
            wrap.appendChild(item)
        })
    }


    wrap.addEventListener('drop', function (e) {
        // console.log('drop  移动节点')
        // e.preventDefault();  // 避免浏览器的默认行为，drop事件的默认行为打开链接
        // console.log(dragObj, enterObj)
        // //在当前元素之前插;
        // if (e.target.className === 'item') {
        //
        //     if (enterObj !== dragObj) {
        //         // 进行排序
        //         if (dragIndex < enterIndex) {
        //             // enterObj.style.transform = 'translate(0,40px)';
        //             enterObj.after(dragObj)
        //         } else {
        //             enterObj.before(dragObj)
        //         }
        //     }
        // }
        // let items = $$('.item');
        // items.forEach((item, i) => {
        //     item.style.transform = `translate(0,0)`;
        //     item.dataset.index = i;
        // })
    })


    wrap.addEventListener('dragover', function (e) {
        // 默认情况下，无法将文字/元素放置到其他元素中。如果需要可以放置，我们要组织默认行为
        e.preventDefault();
    })

    let a = [1, 2, 3, 4, 5]
    console.log(a)
    let start = 1
    let end = 4;
    let num = a.splice(end, 1)[0];
    console.log(num)
    a.splice(0, 0, num)
    console.log(a)


</script>
</body>
</html>
